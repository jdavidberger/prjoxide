# Database

The chip database for prjoxide is ingested into libprjoxide and used to construct the BBA database used by nextpnr.

## Per device files

Each supported device has the following json files to describe it:

### baseaddr.json

Some primitives are internally routed on an LMMI bus that is used for configuration. This file describes the addresses of mapped primitives and the length of their address in bits.

These addresses are mapped with the fuzzer in fuzzers/LIFCL/100-ip-base. This requires, for each device, a mapping between the primitive type in question and it's site. This mapping isn't immediately apparent; but can usually be derived by placing the known number of that primitive in a design and looking at it in the physical designer / routing tool in lattice.

### iodb.json

The IO database file contains information on a particular pins function and logical name for each given package.

Each entry describes the pin in terms of it's physical location. Since all the IO pins are on the outside edge of the chip, you can map the tile as a combination of it's 'offset' and it's 'side' -- a pin on the top for instance with an offset of 58 maps to tile 58, 0. The pio attribute describes which pin in that tile is being described.

The iodb.json files are constructed by running tools/parse_pins.py against the CSV files lattice makes available in the documentation section for each device.

### tilegrid.json

The tile grid file describes where the physical location of the tile is, what it's type is, and where it is encoded into the final bitstream file.

This file is generated by tools/tilegrid_all.py. A new device will require some custom fields in the devices.json file but also tools/extract_tilegrid.py.

## Shared database files

The various .ron files are serialized/deserialized to rust. Each fuzzer deserializes the current database, processes samples, and then reserializes out the updated database. 

### devices.json

This serves as a master listing of each device and metadata associated with that device:

- packages: Comes from various lattice documentation, can also be seen by looking at the radiant device selection dialog.
- frame metadata: There are various necessary peices of data here. All are available in the "sysCONFIG Guide for Nexus Platform" document from the lattice website.
- idcode: This is also availble in the above document. 
- max_row / max_cols: These are retreivable from the physical designer for a given chip, or from the tilegrid metadata file.

This file serves as the central index for devices in the libprjoxide library.

### iptypes

These files are generated by various fuzzers associated with the given primitive. They map out the relationship between configuration parameters and the bits set in the bitstream.

### tiletypes

These files are also generated by fuzzers. While they also map out the relationship between various parameters and bits in the bitstream, they mainly focus on the interconnection between tiles themselves. This gives both a graph on what connections are possible but also the way those connections are configured in the bitstream. 

### timing

This is a collection of a bunch of cell types and a description of the delay timing between pins as well as the setup and hold time for each pin in the cell.